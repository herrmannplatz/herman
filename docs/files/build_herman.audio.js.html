<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>build/herman.audio.js - herman</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="herman"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Matrix.html">Matrix</a></li>
            
                <li><a href="../classes/Node.html">Node</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/herman.html">herman</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: build/herman.audio.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// shim layer with setTimeout fallback
window.requestAnimFrame = (function(){
    return  window.requestAnimationFrame       ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame    ||
            function( callback ){
                window.setTimeout(callback, 1000 / 60);
        };
})();

(function(window) {

    /**
     * @module herman
     * @type {[type]}
     */
    var herman = window.herman = {};    

    /**
     * @property {Number} VERSION herman version
     */
    herman.VERSION = 0;

    /**
     * create namespace
     * @method namespace
     * @param  {string} namespace 
     */
    herman.namespace = function(namespace, func) {
        var ns = namespace.split(&#x27;.&#x27;); // &#x27;canvas.Node&#x27;
        var module = ns.pop(); // &#x27;Node&#x27;
        var o = herman; 

        if(ns[0] === &#x27;herman&#x27;) {
            ns.shift();
        }

        for(var i = 0; i &lt; ns.length; i++){
            o = o[ns[i]] = o[ns[i]] || {};
        } 
        o[module] = func.call(this);
    };

    /**
     * prototypical inheritance helper
     * @param  {Object} child  
     * @param  {Object} parent
     * @return {Object}        
     */
    herman.inherits = function inherits(child, parent) {
        var o = Object.create(parent.prototype);
        o.constructor = child;
        child.prototype = o;
        child.prototype.super = parent.prototype;
        return child.prototype;
    };

})(window);

// TODO: rewind
herman.namespace(&#x27;audio.AudioPlayer&#x27;, function() {
    &quot;use strict&quot;;

// AudioPlayer 
    
    /**
     * influenced by cocos2d SimpleAudioEngine
     */
    var AudioPlayer = (function() {

        var background;

        return {

        // background music
            background : {

                play : function(file, loop) {
                    if(background) {
                        background.stop();
                        background = null;
                    }
                    background = new herman.audio.Sound(file, loop);
                },

                stop : function() {
                    background.stop();
                },

                pause : function() {
                    background.pause();
                },

                resume : function() {
                    background.resume();
                },

                rewind : function() {
                    background.play(0);
                },

                willPlay : function() {
                    // body...
                },

                isPlaying : function() {
                    background.isPlaying();
                },    

                getVolume : function() {
                    return background.getVolume();
                },

                setVolume : function(volume) {
                    background.setVolume();
                }
            },

        // Effects 
            playEffect : function(file, loop, volume) {

            },

            getEffectsVolume : function() {
                // body...
            },

            setEffectsVolume : function(volume) {
                // body...
            },

            pauseEffect : function(id) {
                // body...
            },

            pauseAllEffects : function() {
                // body...
            },

            resumeEffect : function(id) {
                // body...
            },

            resumeAllEffects : function() {
                // body...
            },

            stopEffect : function(id) {
                // body...
            },

            stopAllEffects : function() {
                // body...
            }

        };

    })();


// expose
    return AudioPlayer;

});
/**
 * TODO: supported files
 * TODO: better checks
 * TODO: cross browser implementations
 */
herman.namespace(&#x27;audio.Sound&#x27;, function() {
    &quot;use strict&quot;;

    // audio playback handled by WebAudio
    var WebAudioSound = function() {

        var context = new (window.AudioContext || window.webkitAudioContext)();

        // unlock ios 
        window.addEventListener(&#x27;touchstart&#x27;, function() {
            var buffer = context.createBuffer(1, 1, 22050);
            var source = context.createBufferSource();
            source.buffer = buffer;
            source.connect(context.destination);
            source.start = source.start || source.noteOn;
            source.start(0);
        }, false);

        function Sound(file, loop, volume) {    
            var self = this;    
            this.gainNode = null;
            this.source = null;
            this.startOffset = 0;
            this.startTime = 0;

            this.loop   = (typeof loop === &#x27;undefined&#x27;) ? false : loop;
            this.volume = (typeof volume === &#x27;undefined&#x27;) ? 1 : volume;
            
            var request = new XMLHttpRequest();
            request.open(&#x27;GET&#x27;, file, true);
            request.responseType = &#x27;arraybuffer&#x27;;
            request.onload = function() {
                context.decodeAudioData(request.response, 
                    function(buffer) {
                        self.buffer = buffer;
                        self.play();
                    }, 
                    function(error) {
                        console.warn(&#x27;Unable to play background music &#x27; + file);
                    });
            };
            request.send();
        }

        Sound.prototype._createSource = function(buffer) {
            var source = context.createBufferSource();
            source.buffer = buffer;

            // attach gain node
            var gain = context.createGain();
            source.connect(gain);
            gain.connect(context.destination);

            // handle deprecated methods
            // Web Audio API Change Log: Tue Sep 25 12:56:14 2012 -0700
            source.start = source.start || source.noteOn;
            source.stop = source.stop || source.noteOff;

            return {
                source : source,
                gain : gain
            };
        };

        Sound.prototype.setVolume = function(volume) {
            if (this.gainNode) {
                this.gainNode.gain.value = volume;    
            }
        };

        Sound.prototype.getVolume = function() {
            if (this.gainNode) {
                return this.gainNode.gain.value;    
            }
        };

        Sound.prototype.play = function(offset) {
            this.stop();

            var info = this._createSource(this.buffer);
            this.source = info.source;
            this.gainNode = info.gain;

            // apply sound settings
            this.source.loop = this.loop;
            this.gainNode.gain.value = this.volume;

            this.startTime = context.currentTime;
            this.source.start(0, offset || 0); 
        };

        Sound.prototype.pause = function() {
            this.stop();
            this.startOffset += context.currentTime - this.startTime;
        };

        Sound.prototype.resume = function() {
            this.play(this.startOffset % this.buffer.duration);
        };

        Sound.prototype.stop = function() {
            if (this.source) {
                this.source.stop(0);
            }
        };

        Sound.prototype.isPlaying = function() {
            if (this.source) {
                return this.source.playbackState === this.source.PLAYING_STATE;
            }
        };

        return Sound;
    };

    // audio playback handles by HTML5 Audio Tag 
    var HTML5TagSound = function() {
        function Sound(file, loop, volume) {   
            this.loop   = (typeof loop === &#x27;undefined&#x27;) ? false : loop;
            this.volume = (typeof volume === &#x27;undefined&#x27;) ? 1 : volume;

            this.audio = document.createElement(&#x27;audio&#x27;);
            this.audio.src = file;
            this.audio.loop = this.loop;
            this.audio.volume = this.volume; 
            this.audio.play();
        }

        Sound.prototype.setVolume = function(volume) {
            this.audio.volume = volume;
        };

        Sound.prototype.getVolume = function() {
            return this.audio.volume;
        };

        Sound.prototype.play = function(offset) {
            this.audio.currentTime = offset || 0;
            this.audio.play();
        };

        Sound.prototype.pause = function() {
            this.audio.pause();
        };

        Sound.prototype.resume = function() {
            this.audio.play();
        };

        Sound.prototype.stop = function() {
            this.audio.pause();
            this.audio.currentTime = 0;
        };

        Sound.prototype.isPlaying = function() {
            return !this.audio.paused; 
        };

        return Sound;
    };    

// expose
    var Sound = null;
    try {
        Sound = WebAudioSound();        
    }
    catch(e) {
        console.warn(&#x27;Web Audio API is not supported in this browser&#x27;);
        Sound = HTML5TagSound();
    }
    return Sound;

});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
