/*! herman 2013-12-27 */
window.herman=window.herman||{},function(a){a.VERSION=.1,a.createModule=function(b,c){var d=b.split("."),e=d.pop();if(d.length>1){var f=a;"herman"===d[0]&&d.shift();for(var g=0;g<d.length;g++)f=f[d[g]]=f[d[g]]||{}}a[e]=c.call(this)},a.inherits=function(a,b){var c=Object.create(b.prototype);return c.constructor=a,a.prototype=c,a.prototype.super=b.prototype,a.prototype},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}(window.herman),herman.createModule("Matrix",function(){function a(){this.a11=1,this.a12=0,this.a13=0,this.a21=0,this.a22=1,this.a23=0}var b=Math.PI/180,c=15;return a.prototype={translate:function(a,b){return this.a13+=a,this.a23+=b,this},rotate:function(a){a=(a*b).toFixed(c);var d=Math.sin(a),e=Math.cos(a),f=this.a11,g=this.a21;return this.a11=e*f+d*this.a12,this.a12=-d*f+e*this.a12,this.a21=e*g+d*this.a22,this.a22=-d*g+e*this.a22,this},scale:function(a){return this.a11*=a,this.a12*=a,this.a21*=a,this.a22*=a,this},transform:function(a,b,c,d){return this.translate(a,b).rotate(c).scale(d)},multiply:function(a){var b=this.a11,c=this.a12,d=this.a21,e=this.a22;return this.a11=b*a.a11+c*a.a21,this.a12=b*a.a12+c*a.a22,this.a13=b*a.a13+c*a.a23+this.a13,this.a21=d*a.a11+e*a.a21,this.a22=d*a.a12+e*a.a22,this.a23=d*a.a13+e*a.a23+this.a23,this},identity:function(){return this.a11=1,this.a12=0,this.a13=0,this.a21=0,this.a22=1,this.a23=0,this},print:function(){return"matrix\n"+this.a11+" "+this.a12+" "+this.a13+"\n"+this.a21+" "+this.a22+" "+this.a23+"\n[0] [0] [1]\n"}},a}),herman.createModule("Node",function(){function a(){this.tag=null,this.stage=null,this.parent=null,this.children=[],this.matrix=new herman.Matrix,this.x=0,this.y=0,this.scale=1,this.rotation=0,this.visible=!0}return a.prototype={getMatrix:function(){return this.matrix=(new herman.Matrix).transform(this.x,this.y,this.rotation,this.scale),this.parent&&(this.matrix=this.parent.getMatrix().multiply(this.matrix)),this.matrix},position:function(a,b){this.x=a,this.y=b},rotate:function(a){this.rotation=a},setScale:function(a){this.scale=a},addChild:function(a){this.addChildAt(a,this.children.length)},addChildAt:function(b,c){return 0>c||c>this.children.length?(console.log("index out of bounds"),void 0):(b instanceof a&&!this.hasChild(b)&&(b.parent&&b.parent.removeChild(b),this.children.splice(c,0,b),b.parent=this),void 0)},removeChild:function(b){b instanceof a&&this.hasChild(b)&&this.removeChildAt(this.children.indexOf(b))},removeChildAt:function(a){return 0>a||a>=this.children.length?(console.log("index out of bounds"),void 0):(this.children[a].parent=null,this.children.splice(a,1),void 0)},hasChild:function(a){return-1!==this.children.indexOf(a)},getChildren:function(){return this.children},getChild:function(a){var b=this.children.indexOf(a);return-1!==b?this.children[b]:void 0},getChildAt:function(a){return 0>a||a>=this.children.length?(console.log("index out of bounds"),void 0):this.children[a]}},a}),herman.createModule("herman.DomNode",function(){function a(a){herman.Node.call(this),a?this.element=a:(this.element=document.createElement("div"),this.element.className="node")}var b=herman.inherits(a,herman.Node);return b.update=function(){var a=this.getMatrix();this.element.style&&(this.element.style.webkitTransform="matrix("+a.a11+","+a.a21+","+a.a12+","+a.a22+","+a.a13+","+a.a23+")"),this.children.forEach(function(a){a.update()})},b.addChild=function(a){this.super.addChild.apply(this,arguments),a.update(),document.getElementById("domStage").appendChild(a.element)},b.removeChild=function(){this.super.addChild.apply(this,arguments)},a}),herman.createModule("herman.CanvasNode",function(){function a(a){Node.call(this),this.context=a.getContext("2d")}var b=herman.inherits(a,herman.Node);return b.draw=function(){var a=this.getMatrix();this.context.save(),this.context.setTransform(a.a11,a.a21,a.a12,a.a22,a.a13,a.a23),this.context.fillStyle="rgb(200,0,0)",this.context.fillRect(10,10,55,50),this.context.restore()},b.update=function(){this.draw(),this.children.forEach(function(a){a.update()})},b.position=function(){_s.position.apply(this,arguments),this.parent&&this.update()},b.rotate=function(){_s.rotate.apply(this,arguments),this.parent&&this.update()},b.setScale=function(){_s.setScale.apply(this,arguments),this.parent&&this.update()},b.addChild=function(a){_s.addChild.apply(this,arguments),a.update()},a});